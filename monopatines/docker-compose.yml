services:

#  admin_service:
#    build:
#      context: ./mvc_administracion
#      dockerfile: Dockerfile
#    container_name: admin_service
#    ports:
#      - "8090:8090"
#    hostname: admin_service
#    environment:
#      # Admin usa MongoDB (URL inyectada por env var)
#      - SPRING_DATA_MONGODB_URI=mongodb://db_admin:27017/db_administracion
#    depends_on:
#      - db_admin
#    networks:
#      - db_network

#  db_admin:
#    image: mongo:latest
#    container_name: mongo_admin
#    ports:
#      - "27017:27017"
#    volumes:
#      - mongo_data:/data/db
#    networks:
#      - db_network
  # üßç‚Äç‚ôÇÔ∏è USER-SERVICE
  mvc-usuario:
    build:
      context: ./mvc_usuario
      dockerfile: Dockerfile
    container_name: mvc_usuario
    ports:
      - "8082:8082"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:mysql://db_usuario:3306/db_usuario
      - SPRING_DATASOURCE_USERNAME=root
      - SPRING_DATASOURCE_PASSWORD=1234
    depends_on:
      - db_usuario
    networks:
      - net_monopatines

  db_usuario:
    image: mysql:latest
    container_name: db_usuario
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: 1234
      MYSQL_DATABASE: db_usuario
    ports:
      - "3307:3306"
    volumes:
      - db_usuario_data:/var/lib/mysql
    networks:
      - net_monopatines

  # mvc_monopatin
  mvc-monopatin:
    build:
      context: ./mvc_monopatin
      dockerfile: Dockerfile
    container_name: mvc_monopatin
    ports:
      - "8084:8084"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:mysql://db_monopatin:3306/db_monopatin
      - SPRING_DATASOURCE_USERNAME=root
      - SPRING_DATASOURCE_PASSWORD=1234
    depends_on:
      - db_monopatin
    networks:
      - net_monopatines

  db_monopatin:
    image: mysql:latest
    container_name: db_monopatin
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: 1234
      MYSQL_DATABASE: db_monopatin
    ports:
      - "3308:3306"
    volumes:
      - db_monopatin_data:/var/lib/mysql
    networks:
      - net_monopatines

#  MVC_VIAJE
  mvc-viaje:
    build:
      context: ./mvc_viaje
      dockerfile: Dockerfile
    container_name: mvc_viaje
    ports:
      - "8086:8086"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:mysql://db_viaje:3306/db_viaje
      - SPRING_DATASOURCE_USERNAME=root
      - SPRING_DATASOURCE_PASSWORD=1234
    depends_on:
      - db_viaje
    networks:
      - net_monopatines

  db_viaje:
    image: mysql:latest
    container_name: db_viaje
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: 1234
      MYSQL_DATABASE: db_viaje
    ports:
      - "3309:3306"
    volumes:
      - db_viaje_data:/var/lib/mysql
    networks:
      - net_monopatines

  #  mvc_facturacion
  mvc-facturacion:
    build:
      context: ./mvc_facturacion
      dockerfile: Dockerfile
    container_name: mvc_facturacion
    ports:
      - "8088:8088"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:mysql://db_facturacion:3306/db_facturacion
      - SPRING_DATASOURCE_USERNAME=root
      - SPRING_DATASOURCE_PASSWORD=1234
    depends_on:
      - db_facturacion
    networks:
      - net_monopatines

  db_facturacion:
    image: mysql:latest
    container_name: db_facturacion
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: 1234
      MYSQL_DATABASE: db_facturacion
    ports:
      - "3310:3306"
    volumes:
      - db_facturacion_data:/var/lib/mysql
    networks:
      - net_monopatines


  #  mvc_administracion
#  mvc_administracion:
#    build: ./mvc_administracion
#    container_name: mvc_administracion
#    ports:
#      - "8090:8090"
#    environment:
#      - SPRING_DATASOURCE_URL=jdbc:mysql://db_administracion:3306/db_administracion
#      - SPRING_DATASOURCE_USERNAME=root
#      - SPRING_DATASOURCE_PASSWORD=1234
#    depends_on:
#      - db_administracion
#
#  db_administracion:
#    image: mysql:latest
#    container_name: db_administracion
#    restart: always
#    environment:
#      MYSQL_ROOT_PASSWORD: 1234
#      MYSQL_DATABASE: db_administracion
#    ports:
#      - "3311:3306"
#    volumes:
#      - db_administracion_data:/var/lib/mysql

  # üö™ API-GATEWAY
  api_gateway:
    build:
      context: ./api_gateway
      dockerfile: Dockerfile
    container_name: api_gateway
    ports:
      - "8080:8080"
    depends_on:
       - mvc-usuario
       - mvc-monopatin
       - mvc-viaje
       - mvc-facturacion
     # - mvc_administracion
    networks:
      - net_monopatines
volumes:
  db_usuario_data:
  db_monopatin_data:
  db_viaje_data:
  db_facturacion_data:
#  mongo_data:

networks:
  net_monopatines:
    driver: bridge