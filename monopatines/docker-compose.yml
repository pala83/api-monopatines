services:

#  admin_service:
#    build:
#      context: ./mvc_administracion
#      dockerfile: Dockerfile
#    container_name: admin_service
#    ports:
#      - "8090:8090"
#    hostname: admin_service
#    environment:
#      # Admin usa MongoDB (URL inyectada por env var)
#      - SPRING_DATA_MONGODB_URI=mongodb://db_admin:27017/db_administracion
#    depends_on:
#      - db_admin
#    networks:
#      - db_network

#  db_admin:
#    image: mongo:latest
#    container_name: mongo_admin
#    ports:
#      - "27017:27017"
#    volumes:
#      - mongo_data:/data/db
#    networks:
#      - db_network
  # üßç‚Äç‚ôÇÔ∏è USER-SERVICE
  mvc_usuario:
    build:
      context: ./mvc_usuario
      dockerfile: Dockerfile
    container_name: mvc_usuario
    ports:
      - "8082:8082"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:mysql://db_usuario:3306/db_usuario
      - SPRING_DATASOURCE_USERNAME=root
      - SPRING_DATASOURCE_PASSWORD=1234
    depends_on:
      - db_usuario
    networks:
      - net_monopatines

  db_usuario:
    image: mysql:latest
    container_name: db_usuario
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: 1234
      MYSQL_DATABASE: db_usuario
    ports:
      - "3307:3306"
    volumes:
      - db_usuario_data:/var/lib/mysql
    networks:
      - net_monopatines

  # üõ¥ mvc_monopatin
  mvc_monopatin:
    build:
      context: ./mvc_monopatin
      dockerfile: Dockerfile
    container_name: mvc_monopatin
    ports:
      - "8084:8084"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:mysql://db_monopatin:3306/db_monopatin
      - SPRING_DATASOURCE_USERNAME=root
      - SPRING_DATASOURCE_PASSWORD=1234
    depends_on:
      - db_monopatin
    networks:
      - net_monopatines

  db_monopatin:
    image: mysql:latest
    container_name: db_monopatin
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: 1234
      MYSQL_DATABASE: db_monopatin
    ports:
      - "3308:3306"
    volumes:
      - db_monopatin_data:/var/lib/mysql
    networks:
      - net_monopatines

  #  mvc_facturacion
  mvc_facturacion:
    build:
      context: ./mvc_facturacion
      dockerfile: Dockerfile
    container_name: mvc_facturacion
    ports:
      - "8088:8088"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:mysql://db_facturacion:3306/db_facturacion
      - SPRING_DATASOURCE_USERNAME=root
      - SPRING_DATASOURCE_PASSWORD=1234
    depends_on:
      - db_facturacion
    networks:
      - net_monopatines

  db_facturacion:
    image: mysql:latest
    container_name: db_facturacion
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: 1234
      MYSQL_DATABASE: db_facturacion
    ports:
      - "3310:3306"
    volumes:
      - db_facturacion_data:/var/lib/mysql
    networks:
      - net_monopatines
  # üó∫Ô∏è TRIP-SERVICE
  #  trip-service:
  #    build: ./trip_service
  #    container_name: trip_service
  #    ports:
  #      - "8086:8086"
  #    environment:
  #      - SPRING_DATASOURCE_URL=jdbc:mysql://db_trips:3306/db_trips
  #      - SPRING_DATASOURCE_USERNAME=root
  #      - SPRING_DATASOURCE_PASSWORD=1234
  #    depends_on:
  #      - db_trips
  #
  #  db_trips:
  #    image: mysql:latest
  #    container_name: db_trips
  #    restart: always
  #    environment:
  #      MYSQL_ROOT_PASSWORD: 1234
  #      MYSQL_DATABASE: db_trips
  #    ports:
  #      - "3309:3306"
  #    volumes:
  #      - db_trips_data:/var/lib/mysql

  #  mvc_administracion
#  mvc_administracion:
#    build: ./mvc_administracion
#    container_name: mvc_administracion
#    ports:
#      - "8090:8090"
#    environment:
#      - SPRING_DATASOURCE_URL=jdbc:mysql://db_administracion:3306/db_administracion
#      - SPRING_DATASOURCE_USERNAME=root
#      - SPRING_DATASOURCE_PASSWORD=1234
#    depends_on:
#      - db_administracion
#
#  db_administracion:
#    image: mysql:latest
#    container_name: db_administracion
#    restart: always
#    environment:
#      MYSQL_ROOT_PASSWORD: 1234
#      MYSQL_DATABASE: db_administracion
#    ports:
#      - "3311:3306"
#    volumes:
#      - db_administracion_data:/var/lib/mysql

  # üö™ API-GATEWAY
  api-gateway:
    build:
      context: ./api_gateway
      dockerfile: Dockerfile
    container_name: api_gateway
    ports:
      - "8080:8080"
    volumes:
      - ./api_gateway_config/application.yml:/app/config/application.yml
    environment:
      - SPRING_CONFIG_LOCATION=file:/app/config/application.yml
    depends_on:
       - mvc_usuario
       - mvc_monopatin
#      - trip-service
     # - mvc_administracion
       - mvc_facturacion
    networks:
      - net_monopatines
volumes:
  db_usuario_data:
  db_monopatin_data:
#  db_trips_data:
#  mongo_data:
  db_facturacion_data:

networks:
  net_monopatines:
    driver: bridge